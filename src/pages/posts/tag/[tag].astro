---
import { getAllPosts, getAllTags } from '../../../lib/notion/client.ts'
import Layout from '../../../layouts/Layout.astro'
import PostDate from '../../../components/PostDate.astro'

export async function getStaticPaths() {
  const tags = await getAllTags()
  return tags.map((tag) => ({
    params: { tag: tag.name },
    props: { tag },
  }))
}

const { tag } = Astro.params
const { tag: tagObj } = Astro.props

const allPosts = await getAllPosts()
const posts = allPosts.filter((post) =>
  post.Tags.some((t) => t.name === tag)
)
---

<Layout title={`Tag: ${tag}`}>
  <div slot="main" class="tag-archive-container">
    <header class="archive-header">
      <span class="label">Category / íIî‘çÜ</span>
      <h1>#{tag}</h1>
      <p class="count">{posts.length} entries found</p>
    </header>

    <div class="post-list">
      {posts.map((post) => (
        <article class="archive-item">
          <PostDate post={post} />
          <a href={`/posts/${post.Slug}`}>
            <h2>{post.Title}</h2>
          </a>
        </article>
      ))}
    </div>

    <footer class="archive-footer">
      <a href="/">Å© Back to Library Top</a>
    </footer>
  </div>
</Layout>

<style>
  .tag-archive-container { max-width: 700px; margin: 60px auto; padding: 0 20px; }
  .archive-header { text-align: center; margin-bottom: 80px; border-bottom: 1px solid #eee; padding-bottom: 40px; }
  .label { font-size: 0.75rem; color: #aaa; letter-spacing: 0.2em; text-transform: uppercase; }
  h1 { font-family: "Sawarabi Mincho", serif; font-size: 2.5rem; margin: 10px 0; }
  .count { color: #888; font-family: serif; font-style: italic; }
  
  .archive-item { margin-bottom: 40px; }
  .archive-item h2 { font-family: "Sawarabi Mincho", serif; font-size: 1.4rem; margin: 5px 0; }
  .archive-item a { text-decoration: none; color: #1a1a1a; }
  
  .archive-footer { margin-top: 100px; text-align: center; }
  .archive-footer a { color: #aaa; text-decoration: none; font-size: 0.9rem; }
</style>